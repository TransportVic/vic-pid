extends ../core/pid
include ../metro-lcd/templates/capacity-indicator
include ./templates/next-service-header

block head
  link(rel='stylesheet' href=`${pidStaticBase}/css/colours.css`)
  link(rel='stylesheet' href=`${pidStaticBase}/css/metro-lcd/full-pid-base.css`)
  link(rel='stylesheet' href=`${pidStaticBase}/css/metro-lcd/platform.css`)
  link(rel='stylesheet' href=`${pidStaticBase}/css/metro-lcd/pre-plat-portrait.css`)
  link(rel='stylesheet' href=`${pidStaticBase}/css/metro-lcd/stopping-pattern.css`)
  link(rel='stylesheet' href=`${pidStaticBase}/css/metro-lcd/templates/next-service-header.css`)
  link(rel='stylesheet' href=`${pidStaticBase}/css/metro-lcd/templates/capacity-indicator.css`)

block scripts
  script(src=`${pidStaticBase}/scripts/metro-lcd/platform.mjs` type='module')
  script(src=`${pidStaticBase}/scripts/metro-lcd/pre-plat-landscape.mjs` type='module')
  script(src=`${pidStaticBase}/scripts/metro-lcd/pre-plat-portrait.mjs` type='module')
  if testing
    script(src=`${pidStaticBase}/scripts/test-data.js`)
    script.
      window.onload = () => {
        let pidType = Object.keys(search.hash)[0] || 'platform'
        let pid
        switch (pidType) {
          case 'pre-plat-landscape':
            pid = new PrePlatformLandscapePID()
            break
          case 'pre-plat-portrait':
            pid = new PrePlatformPortraitPID()
            break
          default:
            if (search.hash.cap) pid = new CapMetroLCDPlatformPID(parseInt(search.hash.cap))
            else pid = new MetroLCDPlatformPID()
            break
        }

        window.pid = pid
        pid.updateServices(window.services)
      }

  for script of extraScripts || []
    script(src=script.src)

block pid
  +capacity-indicator-template()
  div.pid.pid-16-9.showing-departure.light
    div#announcements
      img(src=`${pidStaticBase}/img/announcements.svg`)
      p Please Listen For Announcements

    div.line-marker.no-line
    +serviceHeader('compact')

    div.next-service-detail
      div.next-service-pattern
      div.service-message
    div.fixed-message
    div.pid-footer
      div.capacity-indicator-container
      table.subsequent-service-info
        mixin serviceRow()
          tr.subsequent-service.no-line.template
            td.service-sch-time
              span {0}
            td.service-destination
              span {1}
            td.service-summary
              span {2}
            td.service-platform
              span {3}
            td.service-est-time
              span {4}
        +serviceRow()
      div.next-service-message
      div.clock